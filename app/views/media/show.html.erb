<div class="container mt-5">
  <div class="col-md-6">
    <% if @media.poster %>
      <img src="<%= url_for(@media.poster) %>" alt="<%= @media.title %> Poster" class="img-fluid rounded">
    <% else %>
      <p>No poster available</p>
    <% end %>
    <h1><%= @media.title %></h1>
  </div>

  <!-- Navigation Tabs -->
  <ul class="nav nav-tabs" id="media-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="synopsis-tab" data-bs-toggle="tab" data-bs-target="#synopsis" type="button" role="tab" aria-controls="synopsis" aria-selected="true">
        Synopsis
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="cast-tab" data-bs-toggle="tab" data-bs-target="#cast" type="button" role="tab" aria-controls="cast" aria-selected="false">
        Cast
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="seasons-tab" data-bs-toggle="tab" data-bs-target="#seasons" type="button" role="tab" aria-controls="seasons" aria-selected="false">
        Seasons
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">
        Reviews
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content mt-3" id="media-tabs-content">
    <!-- Synopsis Tab -->
    <div class="tab-pane fade show active" id="synopsis" role="tabpanel" aria-labelledby="synopsis-tab">
      <div class="genres-container d-flex">
        <% if @media.genres.present? %>
          <% @media.genres.each do |genre| %>
            <div class="genre-field mx-3">
              <p><em><%= genre[:name] %></em></p>
            </div>
          <% end %>
        <% end %>
      </div>
      <% if @media.synopsis.present? %>
        <p><%= @media.synopsis %></p>
      <% end %>
      <% if @media.run_time.present? %>
        <p><strong>Runtime:</strong> <%= @media.run_time %>min</p>
      <% end %>
      <% if @media.release_date.present? %>
        <p> Release Date: <%= @media.release_date.day.ordinalize %> <%= @media.release_date.strftime("%B %Y") %></p>
      <% end %>
      <% if @media.creator.present? %>
        <p>Creator: <%= @media.creator %></p>
      <% end %>

       <div class="row mt-4">
        <% if current_user.watchlist_media.exists?(media_id: @media.id) %>
        <button class="btn btn-secondary" disabled>Already in Watchlist</button>
        <% else %>
        <%= button_to 'Add to watchlist', watchlist_media_path(media_id: @media.id), method: :post, class: 'btn btn-primary' %>
        <div class="buttons-container">
            <i class="fa-regular fa-plus"></i>
            <i class="fa-solid fa-ranking-star"></i>
            <i class="fa-solid fa-arrow-up-from-bracket"></i>
        </div>
        <% end %>
        </div>

        <div>
        <button class="mt-3"><%= link_to 'View my watchlist', watchlist_media_path%>
        </div>
    </div>

    <!-- Cast Tab -->
    <div class="tab-pane fade" id="cast" role="tabpanel" aria-labelledby="cast-tab">
      <div class="container">
        <div class="row row-cols-2 g-3">
          <% @media.actors.each do |actor| %>
            <div class="col">
              <div class="actor-card d-flex flex-column">
                <% if actor.photos.attached? %>
                  <%= cl_image_tag actor.photos.first.key, alt: "#{actor.name} Poster", class: "img-fluid rounded", style: "height: 100px; width: 50px" %>
                <% else %>
                  <p>No image available</p>
                <% end %>
                <%= actor.name %>
                <%= link_to 'More', actor_show_path(actor, media_id: @media.id) %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Seasons Tab -->
    <div class="tab-pane fade" id="seasons" role="tabpanel" aria-labelledby="seasons-tab">
      <div class="container">
        <div class="row row-cols-2 g-3">
          <% if @media.seasons.present? %>
            <% @media.seasons.sort_by(&:number).each do |season| %>
              <div class="col">
                <div class="season-card">
                  <% if season.poster.attached? %>
                    <%= image_tag url_for(season.poster), class: "img-fluid" %>
                  <% end %>
                  <p class="season-name mb-0"><%= season.name.present? ? season.name : "Season #{season.number}" %></p>
                  <%= link_to 'Episodes', season_path(season.id) %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel" style="height: 80%; width: 100%">
    <div class="carousel-inner">
      <% @media.backdrops.each_with_index do |backdrop, index| %>
        <div class="carousel-item <%= 'active' if index == 0 %>">
          <%= cl_image_tag backdrop.key, class: "img-fluid rounded", alt: "Backdrop" %>
        </div>
      <% end %>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>

<!-- Reviews Tab -->
    <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
      <div class="reviews-container">
        <div class="reviews-row">
          <% if @reviews.present? && @reviews.any? %>
            <% @reviews.each do |review| %>
              <div class="col-6">
                <p><%= review.content %></p>
                  <p><%= review.rating %>⭐️</p>
                    </div>
                  <% end %>
                <% else %>
                <p>No reviews submitted yet.</p>
              <% end %>
            </div>
          </div>
        </div>

<div class="buttons-container">
<div class="row mt-4">
  <% if current_user.watchlist_media.exists?(media_id: @media.id) %>
    <button class="btn btn-primary" disabled>Already in Watchlist</button>
      <% else %>
        <%= button_to 'Add to watchlist', watchlist_media_path(media_id: @media.id), method: :post, class: 'btn btn-primary' %>
        <% end %>
      </div>
    <div>
    <button class="mt-3"><%= link_to 'Add a review', new_medium_review_path(@media) %></button>
    </div>
    <div>
  <button class="mt-3"><%= link_to 'View my watchlist', watchlist_media_path%></button>
  </div>

</div>
