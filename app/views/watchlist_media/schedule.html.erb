<% if @schedule.present? %>
  <% @schedule.each_with_index do |month_data, month_index| %>
    <h2>Month <%= month_index + 1 %></h2>

    <% month_data[:providers].each do |provider_entry| %>
      <% next unless @user_selected_providers.include?(provider_entry[:provider]) %>

      <h3>Provider: <%= provider_entry[:provider] %> (Total Hours: <%= provider_entry[:hours] %>)</h3>
      <ul>
        <% provider_entry[:content].sort_by { |item| [-item[:score], item[:runtime].to_i] }.each do |item| %>
          <li>
            <strong><%= item[:media_item].title %></strong>
            <br>
            Score: <%= item[:score] %> | Runtime: <%= item[:runtime].to_i > 0 ? "#{item[:runtime]} mins" : "Unknown runtime" %>
          </li>
        <% end %>
      </ul>
    <% end %>
  <% end %>
<% else %>
  <p>No schedule available. Please check your watchlist settings.</p>
<% end %>
